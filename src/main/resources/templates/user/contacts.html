<!doctype html>
<html lang="en" th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
  <title>All Your Contacts</title>
</head>

<body>
  <div id="content">
    <!-- Sidebar -->
    <div th:if="${loggedInUser}">
      <div th:replace="~{user/sidebar :: sidebar}"></div>
    </div>
    <!-- Main -->
    <div class="sm:pl-64 pt-20">
      <h1 class="text-5xl text-center">All Your Contacts</h1>
      <p class="text-center mb-5">List of all contacts...</p>
      <div class="contacts_container p-5">
        <div data-th-replace="~{message :: messagebox}"></div>
        <!-- Search + Export -->
        <div class="flex md:flex-row flex-col items-center px-4 justify-between bg-white dark:bg-gray-900 rounded-lg">
          <!-- Search -->
          <form th:object="${contactSearchForm}" th:action="@{/user/contacts/search}" method="get">
            <div class="flex space-x-3 p-5 items-center flex-wrap">
              <select th:field="*{field}"
                class="bg-gray-50 border border-gray-300 text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:text-white">
                <option value="">Select Field</option>
                <option value="name">Name</option>
                <option value="email">Email</option>
                <option value="phoneNumber">Phone</option>
              </select>
              <input th:field="*{value}" type="text" placeholder="Search"
                class="p-2 border rounded-lg dark:bg-gray-700 dark:text-white" />
              <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                Search
              </button>
            </div>
          </form>
          <!-- Export -->
          <button onclick="exportData()" class="px-4 py-2 bg-green-600 text-white rounded-lg">
            Export
          </button>
        </div>
        <!-- Table -->
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg mt-5">
          <table id="contact-table" th:if="${pageContact.totalElements > 0}"
            class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <!-- Header -->
            <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700">
              <tr>
                <th class="px-6 py-3">Name</th>
                <th class="px-6 py-3">Phone</th>
                <th class="px-6 py-3">Links</th>
                <th class="px-6 py-3">Action</th>
              </tr>
            </thead>
            <!-- Body -->
            <tbody>
              <tr th:each="c : ${pageContact.content}" class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                <!-- Name -->
                <td class="px-6 py-4 flex items-center">
                  <img th:src="${c.picture}" src="/images/default.jpg" onerror="this.src = '/images/default.jpg'"
                    class="w-10 h-10 rounded-full" />
                  <div class="ml-3">
                    <div th:text="${c.name}" class="font-semibold"></div>
                    <div th:text="${c.email}" class="text-gray-500"></div>
                  </div>
                </td>
                <!-- Phone -->
                <td class="px-6 py-4">
                  <i class="fa-solid fa-phone mr-2"></i>
                  <span th:text="${c.phoneNumber}"></span>
                </td>
                <!-- Links -->
                <td class="px-6 py-4 space-x-4">
                  <span th:if="${c.favorite}" class="w-2 h-2 bg-green-500 rounded-full inline-block"></span>
                  <a th:if="${c.webSiteLink != null and c.webSiteLink != ''}" th:href="${c.webSiteLink}" target="_blank"
                    class="text-blue-500 hover:text-blue-700">
                    <i class="fa-solid fa-link"></i>
                  </a>
                  <a th:if="${c.linkedInLink != null and c.linkedInLink != ''}" th:href="${c.linkedInLink}"
                    target="_blank" class="text-blue-700 hover:text-blue-900">
                    <i class="fa-brands fa-linkedin"></i>
                  </a>
                </td>
                <!-- Action Icons -->
                <td class="px-6 py-4 space-x-4 relative z-10">
                  <!-- <a th:href="@{'/user/contacts/delete/' + ${c.id}}" class="text-red-500 hover:text-red-700 cursor-pointer"> <i class="fa-solid fa-trash"></i> </a> -->
                  <button th:onclick="deleteContact([[${c.id}]])">
                    <!-- class="text-red-500 hover:text-red-700 cursor-pointer"> -->
                    <i class="fa-solid fa-trash"></i>
                  </button>
                  <a th:href="@{'/user/contacts/view/' + ${c.id}}"
                    class="text-blue-500 hover:text-blue-700 cursor-pointer">
                    <a th:href="@{'/user/contacts/view/' + ${c.id}}">
                      <i class="fa-solid fa-pen"></i>
                    </a>
                  </a>
                  <button type="button" th:onclick="loadContactdata([[${c.id}]])"
                    class="text-green-500 hover:text-green-700 cursor-pointer">
                    <i class="fa-solid fa-eye"></i>
                  </button>

                  <button type="button" th:onclick="openShareModal([[${c.id}]])"
                    class="text-purple-500 hover:text-purple-700"> <i class="fa-solid fa-share"></i>
                  </button>

                  <!-- REMINDER BUTTON -->
                  <button type="button" th:onclick="openReminderModal([[${c.id}]])"
                    class="text-yellow-500 hover:text-yellow-700">
                    <i class="fa-solid fa-bell"></i>
                  </button>

                </td>
              </tr>
            </tbody>
          </table>
          <!-- No Contacts -->
          <div th:if="${pageContact.totalElements == 0}" class="text-center p-5">
            No contacts found
          </div>
        </div>
        <!-- âœ… FIXED PAGINATION -->
        <div th:if="${pageContact.totalPages > 1}" class="text-center mt-5">
          <ul class="inline-flex space-x-2">
            <!-- Previous -->
            <li th:if="${!pageContact.first}">
              <a th:href="@{'/user/contacts?page=' + ${pageContact.number - 1}}"
                class="px-3 py-2 bg-gray-500 text-white rounded">
                Previous
              </a>
            </li>
            <!-- Page Numbers -->
            <li th:each="i : ${#numbers.sequence(0, pageContact.totalPages - 1)}">
              <a th:href="@{'/user/contacts?page=' + ${i}}" th:text="${i + 1}"
                th:classappend="${i == pageContact.number} ? ' bg-blue-600 text-white px-3 py-2 rounded' : ' bg-gray-200 text-black px-3 py-2 rounded'">
              </a>
            </li>
            <!-- Next -->
            <li th:if="${!pageContact.last}">
              <a th:href="@{'/user/contacts?page=' + ${pageContact.number + 1}}"
                class="px-3 py-2 bg-gray-500 text-white rounded">
                Next
              </a>
            </li>
          </ul>
        </div>
      </div>

      <!-- Share Modal -->
      <!-- <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center">
            <div class="bg-white p-6 rounded-lg shadow-lg w-96">
                <h2 class="text-xl font-semibold mb-4"> Share Contact </h2>
                <form id="shareForm" method="post"> <input type="email" name="email" placeholder="Enter user email" required
                        class="w-full p-2 border rounded mb-4" />
                    <div class="flex justify-end space-x-2"> <button type="button" onclick="closeShareModal()"
                            class="px-4 py-2 bg-gray-500 text-white rounded"> Cancel </button> <button type="submit"
                            class="px-4 py-2 bg-purple-600 text-white rounded"> Share </button> </div>
                </form>
            </div>
        </div>
        </div> -->
        <!-- REMINDER MODAL -->
<div id="reminderModal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">

    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-96">

        <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">
            Add Reminder
        </h2>

        <form id="reminderForm"
              method="post"
              th:action="@{/user/reminders/add}">

            <input type="hidden"
                   name="contactId"
                   id="reminderContactId"/>


            <input type="text"
                   name="message"
                   placeholder="Reminder message"
                   required
                   class="w-full p-2 border rounded mb-4 text-black"/>


            <input type="datetime-local"
                   name="dateTime"
                   required
                   class="w-full p-2 border rounded mb-4 text-black"/>


            <div class="flex justify-end space-x-2">

                <button type="button"
                        onclick="closeReminderModal()"
                        class="px-4 py-2 bg-gray-500 text-white rounded">
                    Cancel
                </button>

                <button type="submit"
                        class="px-4 py-2 bg-yellow-600 text-white rounded">
                    Save
                </button>

            </div>

        </form>

    </div>

</div>
      <div data-th-replace="~{user/contact_modals :: contact}"></div>
      <!-- </div> -->

      <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50">

        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-96">

          <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">
            Share Contact
          </h2>

          <form id="shareForm" method="post">

            <input type="email" name="email" placeholder="Enter user email" required
              class="w-full p-2 border rounded mb-4 text-black" />

            <div class="flex justify-end space-x-2">

              <button type="button" onclick="closeShareModal()" class="px-4 py-2 bg-gray-500 text-white rounded">
                Cancel
              </button>

              <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700">
                Share
              </button>

            </div>

          </form>

        </div>

      </div>
    </div>
    <!-- Script Fragment -->
    <div th:fragment="script">
      <script data-th-src="@{'/js/contacts.js'}"></script>
      <script src="https://cdn.jsdelivr.net/npm/@linways/table-to-excel@1.0.4/dist/tableToExcel.min.js"></script>
      <script>
        function exportData() {
          TableToExcel.convert(document.getElementById("contact-table"), {
            name: "contacts.csv",
            sheet: { sheet: "Sheet 1" },
          });
        }
      </script>
    </div>
</body>

</html>