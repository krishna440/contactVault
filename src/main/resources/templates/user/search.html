<!DOCTYPE html>
<html lang="en"
      th:replace="~{base :: parent(~{::#content},~{::title},~{::script})}">

<head>
    <title>Search Contacts</title>
</head>

<body>

<div id="content">

    <!-- Sidebar -->
    <div th:if="${loggedInUser}">
        <div th:replace="~{user/sidebar :: sidebar}"></div>
    </div>

    <!-- Main -->
    <div class="sm:pl-64 pt-20">

        <!-- Title -->
        <div class="flex justify-center flex-col items-center">

            <h1 class="text-5xl">Search Results</h1>

            <!-- ✅ Show number of results -->
            <p th:if="${pageContact != null}"
               th:text="${pageContact.totalElements} + ' result(s) found'"
               class="text-gray-400 mt-2">
            </p>

        </div>

        <div class="contacts_container p-5">

            <!-- Search + Export -->
            <div class="flex md:flex-row flex-col items-center px-4 justify-between bg-white dark:bg-gray-900 rounded-lg">

                <form th:object="${contactSearchForm}"
                      th:action="@{/user/contacts/search}"
                      method="get">

                    <div class="flex space-x-3 p-5 items-center flex-wrap">

                        <!-- Field select -->
                        <select th:field="*{field}"
                                class="bg-gray-50 border border-gray-300 text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:text-white">

                            <option value="">Select Field</option>
                            <option value="name">Name</option>
                            <option value="email">Email</option>
                            <option value="phoneNumber">Phone</option>

                        </select>

                        <!-- Search input -->
                        <input th:field="*{value}"
                               type="text"
                               placeholder="Search"
                               class="p-2 border rounded-lg dark:bg-gray-700 dark:text-white"/>

                        <button type="submit"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg">
                            Search
                        </button>

                    </div>

                </form>

                <!-- Export -->
                <button onclick="exportData()"
                        class="px-4 py-2 bg-green-600 text-white rounded-lg">
                    Export
                </button>

            </div>

            <!-- Table -->
            <div class="relative overflow-x-auto shadow-md sm:rounded-lg mt-5">

                <table id="contact-table"
                       th:if="${pageContact != null and pageContact.totalElements > 0}"
                       class="w-full text-sm text-left text-gray-500 dark:text-gray-400">

                    <!-- Header -->
                    <thead class="text-xs uppercase bg-gray-50 dark:bg-gray-700">

                    <tr>
                        <th class="px-6 py-3">Name</th>
                        <th class="px-6 py-3">Phone</th>
                        <th class="px-6 py-3">Links</th>
                        <th class="px-6 py-3">Action</th>
                    </tr>

                    </thead>

                    <!-- Body -->
                    <tbody>

                    <tr th:each="c : ${pageContact.content}"
                        class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">

                        <!-- Name -->
                        <td class="px-6 py-4 flex items-center">

                            <img th:src="${c.picture}"
                                 src="/images/default.jpg"
                                 onerror="this.src='/images/default.jpg'"
                                 class="w-10 h-10 rounded-full">

                            <div class="ml-3">

                                <div th:text="${c.name}"
                                     class="font-semibold"></div>

                                <div th:text="${c.email}"
                                     class="text-gray-500"></div>

                            </div>

                        </td>

                        <!-- Phone -->
                        <td class="px-6 py-4">

                            <i class="fa-solid fa-phone mr-2"></i>

                            <span th:text="${c.phoneNumber}"></span>

                        </td>

                        <!-- Links -->
                        <td class="px-6 py-4 space-x-4">

                            <span th:if="${c.favorite}"
                                  class="w-2 h-2 bg-green-500 rounded-full inline-block"></span>

                            <a th:if="${c.webSiteLink != null and c.webSiteLink != ''}"
                               th:href="${c.webSiteLink}"
                               target="_blank"
                               class="text-blue-500">

                                <i class="fa-solid fa-link"></i>

                            </a>

                            <a th:if="${c.linkedInLink != null and c.linkedInLink != ''}"
                               th:href="${c.linkedInLink}"
                               target="_blank"
                               class="text-blue-700">

                                <i class="fa-brands fa-linkedin"></i>

                            </a>

                        </td>

                        <!-- Action Icons -->
                        <td class="px-6 py-4 space-x-4">

                            <span class="text-red-500">
                                <i class="fa-solid fa-trash"></i>
                            </span>

                            <span class="text-green-500">
                                <i class="fa-solid fa-pen"></i>
                            </span>

                            <span class="text-blue-500">
                                <i class="fa-solid fa-eye"></i>
                            </span>

                        </td>

                    </tr>

                    </tbody>

                </table>

                <!-- No results -->
                <div th:if="${pageContact == null or pageContact.totalElements == 0}"
                     class="text-center p-5 text-red-500">

                    No results found

                </div>

            </div>

            <!-- ✅ SEARCH PAGINATION -->
            <div th:if="${pageContact != null and pageContact.totalPages > 1}"
                 class="text-center mt-5">

                <ul class="inline-flex space-x-2">

                    <!-- Previous -->
                    <li th:if="${!pageContact.first}">
                        <a th:href="@{'/user/contacts/search?page=' + ${pageContact.number - 1}
                                     + '&size=' + ${pageSize}
                                     + '&field=' + ${contactSearchForm.field}
                                     + '&value=' + ${contactSearchForm.value}}"

                           class="px-3 py-2 bg-gray-500 text-white rounded">
                            Previous
                        </a>
                    </li>

                    <!-- Page numbers -->
                    <li th:each="i : ${#numbers.sequence(0, pageContact.totalPages - 1)}">

                        <a th:href="@{'/user/contacts/search?page=' + ${i}
                                     + '&size=' + ${pageSize}
                                     + '&field=' + ${contactSearchForm.field}
                                     + '&value=' + ${contactSearchForm.value}}"

                           th:text="${i + 1}"

                           th:classappend="${i == pageContact.number} ?
                           ' bg-blue-600 text-white px-3 py-2 rounded' :
                           ' bg-gray-200 text-black px-3 py-2 rounded'">
                        </a>

                    </li>

                    <!-- Next -->
                    <li th:if="${!pageContact.last}">
                        <a th:href="@{'/user/contacts/search?page=' + ${pageContact.number + 1}
                                     + '&size=' + ${pageSize}
                                     + '&field=' + ${contactSearchForm.field}
                                     + '&value=' + ${contactSearchForm.value}}"

                           class="px-3 py-2 bg-gray-500 text-white rounded">
                            Next
                        </a>
                    </li>

                </ul>

            </div>

        </div>

    </div>

</div>

<!-- Scripts -->
<div th:fragment="script">

<script src="https://cdn.jsdelivr.net/npm/@linways/table-to-excel@1.0.4/dist/tableToExcel.min.js"></script>

<script>
function exportData() {
    TableToExcel.convert(document.getElementById("contact-table"), {
        name: "search-results.xlsx"
    });
}
</script>

</div>

</body>
</html>
